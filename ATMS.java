/*
 * Improved ATM System with automatic interest rates and reordered loan fields
 */
package ATM_Systems;

import javax.swing.JFrame;
import javax.swing.JOptionPane;
import java.awt.event.KeyEvent;
import java.text.SimpleDateFormat;
import java.util.Calendar;

/**
 * @author sclif
 */
public class ATMS extends javax.swing.JFrame {

    private static final java.util.logging.Logger logger = java.util.logging.Logger.getLogger(ATMS.class.getName());
    private JFrame frame;
    private double currentBalance = 1000.0; // Initial balance
    private int pinAttempts = 0; // Track PIN attempts
    private static final int MAX_PIN_ATTEMPTS = 3;

    /**
     * Creates new form ATMS
     */
    public ATMS() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">
    private void initComponents() {

        jScrollPane2 = new javax.swing.JScrollPane();
        jTextArea2 = new javax.swing.JTextArea();
        jPanel1 = new javax.swing.JPanel();
        jbtnBalance = new javax.swing.JButton();
        jbtnWithdraw = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();
        jlblDisplay = new javax.swing.JLabel();
        jlblPinStatus = new javax.swing.JLabel(); // Status label below PIN display
        jlblBalance = new javax.swing.JLabel();
        jlblLoan = new javax.swing.JLabel();
        jlblWithdraw = new javax.swing.JLabel();
        jlblDeposit = new javax.swing.JLabel();
        jPanel4 = new javax.swing.JPanel();
        jbtn1 = new javax.swing.JButton();
        jbtn2 = new javax.swing.JButton();
        jbtn3 = new javax.swing.JButton();
        jbtnCancel = new javax.swing.JButton();
        jbtn4 = new javax.swing.JButton();
        jbtn5 = new javax.swing.JButton();
        jbtn6 = new javax.swing.JButton();
        jbtnClear = new javax.swing.JButton();
        jbtn7 = new javax.swing.JButton();
        jbtn8 = new javax.swing.JButton();
        jbtn9 = new javax.swing.JButton();
        jbtnEnter = new javax.swing.JButton();
        jbtnZero = new javax.swing.JButton();
        jButton14 = new javax.swing.JButton();
        jButton15 = new javax.swing.JButton();
        jButton16 = new javax.swing.JButton();
        jPanel5 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jtxtReceipt = new javax.swing.JTextArea();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jtxtnumberofyears = new javax.swing.JTextField();
        jtxtEnteloanamount = new javax.swing.JTextField();
        jtxtInterestRate = new javax.swing.JTextField(); // Changed from jtxtEnter
        jlblmonthlyPayment = new javax.swing.JTextField();
        jlbltotalPayment = new javax.swing.JTextField();
        jLoanCal = new javax.swing.JButton();
        jReset = new javax.swing.JButton();
        jReceipt = new javax.swing.JButton();
        jExit = new javax.swing.JButton();
        jPanel6 = new javax.swing.JPanel();
        jbtnLoan = new javax.swing.JButton();
        jbtnDeposit = new javax.swing.JButton();

        jTextArea2.setColumns(20);
        jTextArea2.setRows(5);
        jScrollPane2.setViewportView(jTextArea2);

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("ATM Management System");
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowActivated(java.awt.event.WindowEvent evt) {
                formWindowActivated(evt);
            }
        });

        jPanel1.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0), 2));

        jbtnBalance.setText("Balance");
        jbtnBalance.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtnBalanceActionPerformed(evt);
            }
        });

        jbtnWithdraw.setText("Withdraw");
        jbtnWithdraw.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtnWithdrawActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
                jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel1Layout.createSequentialGroup()
                                .addContainerGap()
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(jbtnWithdraw, javax.swing.GroupLayout.DEFAULT_SIZE, 94,
                                                Short.MAX_VALUE)
                                        .addComponent(jbtnBalance, javax.swing.GroupLayout.DEFAULT_SIZE,
                                                javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                                .addContainerGap()));
        jPanel1Layout.setVerticalGroup(
                jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel1Layout.createSequentialGroup()
                                .addContainerGap()
                                .addComponent(jbtnBalance, javax.swing.GroupLayout.PREFERRED_SIZE, 37,
                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(jbtnWithdraw, javax.swing.GroupLayout.PREFERRED_SIZE, 37,
                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addContainerGap(8, Short.MAX_VALUE)));

        jPanel2.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0), 2));

        jlblDisplay.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        jlblDisplay.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);

        jlblPinStatus.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        jlblPinStatus.setFont(new java.awt.Font("Segoe UI", 1, 18));
        jlblPinStatus.setText("Enter PIN");

        jlblBalance.setText("Balance");
        jlblLoan.setText("Loan");
        jlblWithdraw.setText("Withdraw");
        jlblDeposit.setText("Deposit");

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
                jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel2Layout.createSequentialGroup()
                                .addGap(18, 18, 18)
                                .addGroup(jPanel2Layout
                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                        .addGroup(jPanel2Layout.createSequentialGroup()
                                                .addComponent(jlblWithdraw)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                                .addComponent(jlblDeposit))
                                        .addGroup(jPanel2Layout.createSequentialGroup()
                                                .addComponent(jlblBalance)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                                .addComponent(jlblLoan))
                                        .addComponent(jlblDisplay, javax.swing.GroupLayout.PREFERRED_SIZE, 162,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jlblPinStatus, javax.swing.GroupLayout.PREFERRED_SIZE, 162,
                                                javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)));
        jPanel2Layout.setVerticalGroup(
                jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel2Layout.createSequentialGroup()
                                .addGap(15, 15, 15)
                                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                        .addComponent(jlblBalance)
                                        .addComponent(jlblLoan))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jlblDisplay, javax.swing.GroupLayout.PREFERRED_SIZE, 28,
                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jlblPinStatus, javax.swing.GroupLayout.PREFERRED_SIZE, 20,
                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                        .addComponent(jlblWithdraw)
                                        .addComponent(jlblDeposit))
                                .addGap(21, 21, 21)));

        jPanel4.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0), 2));

        jbtn1.setText("1");
        jbtn1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtn1ActionPerformed(evt);
            }
        });

        jbtn2.setText("2");
        jbtn2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtn2ActionPerformed(evt);
            }
        });

        jbtn3.setText("3");
        jbtn3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtn3ActionPerformed(evt);
            }
        });

        jbtnCancel.setBackground(new java.awt.Color(255, 0, 0));
        jbtnCancel.setText("Cancel");
        jbtnCancel.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtnCancelActionPerformed(evt);
            }
        });

        jbtn4.setText("4");
        jbtn4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtn4ActionPerformed(evt);
            }
        });

        jbtn5.setText("5");
        jbtn5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtn5ActionPerformed(evt);
            }
        });

        jbtn6.setText("6");
        jbtn6.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtn6ActionPerformed(evt);
            }
        });

        jbtnClear.setBackground(new java.awt.Color(255, 204, 51));
        jbtnClear.setText("Clear");
        jbtnClear.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtnClearActionPerformed(evt);
            }
        });

        jbtn7.setText("7");
        jbtn7.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtn7ActionPerformed(evt);
            }
        });

        jbtn8.setText("8");
        jbtn8.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtn8ActionPerformed(evt);
            }
        });

        jbtn9.setText("9");
        jbtn9.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtn9ActionPerformed(evt);
            }
        });

        jbtnEnter.setBackground(new java.awt.Color(0, 153, 51));
        jbtnEnter.setText("Enter");
        jbtnEnter.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtnEnterActionPerformed(evt);
            }
        });

        jbtnZero.setText("0");
        jbtnZero.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtnZeroActionPerformed(evt);
            }
        });

        jButton14.setText(".");
        jButton14.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton14ActionPerformed(evt);
            }
        });

        jButton15.setText("00");
        jButton15.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton15ActionPerformed(evt);
            }
        });

        jButton16.setText("#");

        javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
        jPanel4.setLayout(jPanel4Layout);
        jPanel4Layout.setHorizontalGroup(
                jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel4Layout.createSequentialGroup()
                                .addContainerGap()
                                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addGroup(jPanel4Layout.createSequentialGroup()
                                                .addComponent(jbtn1, javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(jbtn2, javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(jbtn3, javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(jbtnCancel, javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE))
                                        .addGroup(jPanel4Layout.createSequentialGroup()
                                                .addComponent(jbtn4, javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(jbtn5, javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(jbtn6, javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(jbtnClear, javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE))
                                        .addGroup(jPanel4Layout.createSequentialGroup()
                                                .addGroup(jPanel4Layout
                                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING,
                                                                false)
                                                        .addGroup(jPanel4Layout.createSequentialGroup()
                                                                .addComponent(jButton14,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                                .addPreferredGap(
                                                                        javax.swing.LayoutStyle.ComponentPlacement.RELATED,
                                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                        Short.MAX_VALUE)
                                                                .addComponent(jbtnZero,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE))
                                                        .addGroup(jPanel4Layout.createSequentialGroup()
                                                                .addComponent(jbtn7,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                                .addPreferredGap(
                                                                        javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                                .addComponent(jbtn8,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE)))
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addGroup(jPanel4Layout
                                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                                        .addGroup(jPanel4Layout.createSequentialGroup()
                                                                .addComponent(jbtn9,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                                .addPreferredGap(
                                                                        javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                                .addComponent(jbtnEnter,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE))
                                                        .addGroup(jPanel4Layout.createSequentialGroup()
                                                                .addComponent(jButton15,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                                .addPreferredGap(
                                                                        javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                                .addComponent(jButton16,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE, 100,
                                                                        javax.swing.GroupLayout.PREFERRED_SIZE)))))
                                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)));
        jPanel4Layout.setVerticalGroup(
                jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel4Layout.createSequentialGroup()
                                .addContainerGap()
                                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(jbtnCancel, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jbtn3, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jbtn2, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jbtn1, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(jbtn4, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jbtn5, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jbtn6, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jbtnClear, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(jbtn7, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jbtn8, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jbtn9, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jbtnEnter, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(jbtnZero, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jButton14, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jButton15, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jButton16, javax.swing.GroupLayout.PREFERRED_SIZE, 61,
                                                javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)));

        jPanel5.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0), 2));

        // Reordered labels to match the new layout
        jLabel1.setFont(new java.awt.Font("Segoe UI", 1, 18)); // NOI18N
        jLabel1.setText("Number of years");

        jtxtReceipt.setColumns(20);
        jtxtReceipt.setLineWrap(true);
        jtxtReceipt.setRows(5);
        jtxtReceipt.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jtxtReceipt.setEditable(false);
        jScrollPane1.setViewportView(jtxtReceipt);

        jLabel2.setFont(new java.awt.Font("Segoe UI", 1, 18)); // NOI18N
        jLabel2.setText("Amount of loan");

        jLabel3.setFont(new java.awt.Font("Segoe UI", 1, 18)); // NOI18N
        jLabel3.setText("Interest rate");

        jLabel4.setFont(new java.awt.Font("Segoe UI", 1, 18)); // NOI18N
        jLabel4.setText("Monthly payment");

        jLabel5.setFont(new java.awt.Font("Segoe UI", 1, 18)); // NOI18N
        jLabel5.setText("Total payment");

        // Input validation for years (integers only)
        jtxtnumberofyears.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jtxtnumberofyearsKeyTyped(evt);
            }
        });

        // Input validation and automatic interest rate calculation
        jtxtEnteloanamount.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                jtxtEnteloanamountKeyTyped(evt);
            }

            public void keyReleased(java.awt.event.KeyEvent evt) {
                updateInterestRate();
            }
        });

        // Interest rate field is read-only (automatically calculated)
        jtxtInterestRate.setEditable(false);
        jtxtInterestRate.setBackground(new java.awt.Color(240, 240, 240));

        jlblmonthlyPayment.setEditable(false);
        jlbltotalPayment.setEditable(false);

        jLoanCal.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLoanCal.setText("Calculate Loan");
        jLoanCal.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jLoanCalActionPerformed(evt);
            }
        });

        jReset.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jReset.setText("Reset");
        jReset.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jResetActionPerformed(evt);
            }
        });

        jReceipt.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jReceipt.setText("Receipt");
        jReceipt.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jReceiptActionPerformed(evt);
            }
        });

        jExit.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jExit.setText("Exit");
        jExit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jExitActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel5Layout = new javax.swing.GroupLayout(jPanel5);
        jPanel5.setLayout(jPanel5Layout);
        jPanel5Layout.setHorizontalGroup(
                jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel5Layout.createSequentialGroup()
                                .addGap(15, 15, 15)
                                .addGroup(jPanel5Layout
                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                        .addComponent(jLabel5, javax.swing.GroupLayout.Alignment.LEADING,
                                                javax.swing.GroupLayout.DEFAULT_SIZE, 166, Short.MAX_VALUE)
                                        .addComponent(jLabel4, javax.swing.GroupLayout.Alignment.LEADING,
                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addComponent(jLabel3, javax.swing.GroupLayout.Alignment.LEADING,
                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addComponent(jLabel2, javax.swing.GroupLayout.Alignment.LEADING,
                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addComponent(jLabel1, javax.swing.GroupLayout.DEFAULT_SIZE,
                                                javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(jPanel5Layout
                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                        .addComponent(jlbltotalPayment, javax.swing.GroupLayout.Alignment.LEADING,
                                                javax.swing.GroupLayout.DEFAULT_SIZE, 100, Short.MAX_VALUE)
                                        .addComponent(jlblmonthlyPayment, javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(jtxtInterestRate, javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(jtxtEnteloanamount, javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(jtxtnumberofyears, javax.swing.GroupLayout.Alignment.LEADING))
                                .addGap(18, 18, 18)
                                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addGroup(jPanel5Layout.createSequentialGroup()
                                                .addComponent(jLoanCal, javax.swing.GroupLayout.PREFERRED_SIZE, 90,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addGap(18, 18, 18)
                                                .addComponent(jReset, javax.swing.GroupLayout.PREFERRED_SIZE, 90,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addGap(20, 20, 20)
                                                .addComponent(jReceipt, javax.swing.GroupLayout.PREFERRED_SIZE, 90,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addGap(18, 18, 18)
                                                .addComponent(jExit, javax.swing.GroupLayout.PREFERRED_SIZE, 90,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE))
                                        .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 416,
                                                javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addContainerGap(17, Short.MAX_VALUE)));
        jPanel5Layout.setVerticalGroup(
                jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel5Layout.createSequentialGroup()
                                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addGroup(jPanel5Layout.createSequentialGroup()
                                                .addGap(58, 58, 58)
                                                .addGroup(jPanel5Layout
                                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                                        .addComponent(jLabel1)
                                                        .addComponent(jtxtnumberofyears,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE))
                                                .addGap(18, 18, 18)
                                                .addGroup(jPanel5Layout
                                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                                        .addComponent(jLabel2)
                                                        .addComponent(jtxtEnteloanamount,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE))
                                                .addGap(18, 18, 18)
                                                .addGroup(jPanel5Layout
                                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                                        .addComponent(jLabel3)
                                                        .addComponent(jtxtInterestRate,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE))
                                                .addGap(18, 18, 18)
                                                .addGroup(jPanel5Layout
                                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                                        .addComponent(jLabel4)
                                                        .addComponent(jlblmonthlyPayment,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE))
                                                .addGap(18, 18, 18)
                                                .addGroup(jPanel5Layout
                                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                                        .addComponent(jLabel5)
                                                        .addComponent(jlbltotalPayment,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE)))
                                        .addGroup(jPanel5Layout.createSequentialGroup()
                                                .addGap(25, 25, 25)
                                                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 271,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addGap(30, 30, 30)
                                                .addGroup(jPanel5Layout
                                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                                        .addComponent(jLoanCal, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                36, javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addComponent(jReset, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                36, javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addComponent(jReceipt, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                36, javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addComponent(jExit, javax.swing.GroupLayout.PREFERRED_SIZE, 36,
                                                                javax.swing.GroupLayout.PREFERRED_SIZE))))
                                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)));

        jPanel6.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0), 2));

        jbtnLoan.setText("Loan");
        jbtnLoan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtnLoanActionPerformed(evt);
            }
        });

        jbtnDeposit.setText("Deposit");
        jbtnDeposit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbtnDepositActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel6Layout = new javax.swing.GroupLayout(jPanel6);
        jPanel6.setLayout(jPanel6Layout);
        jPanel6Layout.setHorizontalGroup(
                jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel6Layout.createSequentialGroup()
                                .addContainerGap()
                                .addGroup(jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(jbtnDeposit, javax.swing.GroupLayout.DEFAULT_SIZE, 94,
                                                Short.MAX_VALUE)
                                        .addComponent(jbtnLoan, javax.swing.GroupLayout.DEFAULT_SIZE,
                                                javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                                .addContainerGap()));
        jPanel6Layout.setVerticalGroup(
                jPanel6Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel6Layout.createSequentialGroup()
                                .addContainerGap()
                                .addComponent(jbtnLoan, javax.swing.GroupLayout.PREFERRED_SIZE, 37,
                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(jbtnDeposit, javax.swing.GroupLayout.PREFERRED_SIZE, 37,
                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addContainerGap(8, Short.MAX_VALUE)));

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
                layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(layout.createSequentialGroup()
                                .addGap(17, 17, 17)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                        .addComponent(jPanel4, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                javax.swing.GroupLayout.DEFAULT_SIZE,
                                                javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addGroup(layout.createSequentialGroup()
                                                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                                .addComponent(jPanel6, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jPanel5, javax.swing.GroupLayout.PREFERRED_SIZE,
                                        javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addContainerGap(14, Short.MAX_VALUE)));
        layout.setVerticalGroup(
                layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(layout.createSequentialGroup()
                                .addGap(50, 50, 50)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                        .addComponent(jPanel5, javax.swing.GroupLayout.DEFAULT_SIZE,
                                                javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addGroup(layout.createSequentialGroup()
                                                .addGroup(layout
                                                        .createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING,
                                                                false)
                                                        .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                                        .addComponent(jPanel6, javax.swing.GroupLayout.DEFAULT_SIZE,
                                                                javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                                        .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                                104, Short.MAX_VALUE))
                                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                                .addComponent(jPanel4, javax.swing.GroupLayout.PREFERRED_SIZE,
                                                        javax.swing.GroupLayout.DEFAULT_SIZE,
                                                        javax.swing.GroupLayout.PREFERRED_SIZE)))
                                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)));

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>

    // Method to automatically calculate and set interest rate based on loan amount
    private void updateInterestRate() {
        try {
            if (!jtxtEnteloanamount.getText().trim().isEmpty()) {
                double loanAmount = Double.parseDouble(jtxtEnteloanamount.getText());
                double interestRate;

                // Set interest rate based on loan amount
                if (loanAmount >= 100000) { // 100k to 1M+
                    interestRate = 6.0;
                } else if (loanAmount >= 20000) { // 20k to 99,999
                    interestRate = 5.5;
                } else if (loanAmount >= 1) { // 1 to 19,999
                    interestRate = 5.0;
                } else {
                    interestRate = 0.0; // Invalid amount
                }

                jtxtInterestRate.setText(String.format("%.1f%%", interestRate));
            } else {
                jtxtInterestRate.setText("");
            }
        } catch (NumberFormatException e) {
            jtxtInterestRate.setText("");
        }
    }

    // Event handlers for number buttons
    private void jbtn1ActionPerformed(java.awt.event.ActionEvent evt) {
        String enterNumber = jlblDisplay.getText() + "1";
        jlblDisplay.setText(enterNumber);
    }

    private void jbtn2ActionPerformed(java.awt.event.ActionEvent evt) {
        String enterNumber = jlblDisplay.getText() + "2";
        jlblDisplay.setText(enterNumber);
    }

    private void jbtn3ActionPerformed(java.awt.event.ActionEvent evt) {
        String enterNumber = jlblDisplay.getText() + "3";
        jlblDisplay.setText(enterNumber);
    }

    private void jbtn4ActionPerformed(java.awt.event.ActionEvent evt) {
        String enterNumber = jlblDisplay.getText() + "4";
        jlblDisplay.setText(enterNumber);
    }

    private void jbtn5ActionPerformed(java.awt.event.ActionEvent evt) {
        String enterNumber = jlblDisplay.getText() + "5";
        jlblDisplay.setText(enterNumber);
    }

    private void jbtn6ActionPerformed(java.awt.event.ActionEvent evt) {
        String enterNumber = jlblDisplay.getText() + "6";
        jlblDisplay.setText(enterNumber);
    }

    private void jbtn7ActionPerformed(java.awt.event.ActionEvent evt) {
        String enterNumber = jlblDisplay.getText() + "7";
        jlblDisplay.setText(enterNumber);
    }

    private void jbtn8ActionPerformed(java.awt.event.ActionEvent evt) {
        String enterNumber = jlblDisplay.getText() + "8";
        jlblDisplay.setText(enterNumber);
    }

    private void jbtn9ActionPerformed(java.awt.event.ActionEvent evt) {
        String enterNumber = jlblDisplay.getText() + "9";
        jlblDisplay.setText(enterNumber);
    }

    private void jbtnZeroActionPerformed(java.awt.event.ActionEvent evt) {
        String enterNumber = jlblDisplay.getText() + "0";
        jlblDisplay.setText(enterNumber);
    }

    private void jButton14ActionPerformed(java.awt.event.ActionEvent evt) {
        String enterNumber = jlblDisplay.getText() + ".";
        if (!jlblDisplay.getText().contains(".")) {
            jlblDisplay.setText(enterNumber);
        }
    }

    private void jButton15ActionPerformed(java.awt.event.ActionEvent evt) {
        String enterNumber = jlblDisplay.getText() + "00";
        jlblDisplay.setText(enterNumber);
    }

    // PIN verification and system access with 3 attempts limit
    private void jbtnEnterActionPerformed(java.awt.event.ActionEvent evt) {
        try {
            if (jlblDisplay.getText().isEmpty()) {
                jlblPinStatus.setText("Enter PIN");
                return;
            }

            int pin = Integer.parseInt(jlblDisplay.getText());
            if (pin == 1234) {
                // Correct PIN
                jbtnBalance.setEnabled(true);
                jbtnLoan.setEnabled(true);
                jbtnWithdraw.setEnabled(true);
                jbtnDeposit.setEnabled(true);
                jlblDisplay.setText("");
                jlblPinStatus.setText("Access Granted");
                jlblPinStatus.setForeground(new java.awt.Color(0, 153, 0)); // Green color
                pinAttempts = 0; // Reset attempts on successful login
            } else {
                // Incorrect PIN
                pinAttempts++;
                if (pinAttempts >= MAX_PIN_ATTEMPTS) {
                    jlblPinStatus.setText("Card Blocked - Too Many Attempts");
                    jlblPinStatus.setForeground(new java.awt.Color(255, 0, 0)); // Red color
                    jlblDisplay.setText("BLOCKED");

                    // Disable all number buttons and enter button
                    disableAllButtons();

                    JOptionPane.showMessageDialog(this,
                            "Your card has been blocked due to too many incorrect PIN attempts.\nPlease contact your bank.",
                            "Card Blocked", JOptionPane.ERROR_MESSAGE);
                } else {
                    int remainingAttempts = MAX_PIN_ATTEMPTS - pinAttempts;
                    jlblPinStatus.setText("Invalid PIN - " + remainingAttempts + " attempts left");
                    jlblPinStatus.setForeground(new java.awt.Color(255, 0, 0)); // Red color
                    jlblDisplay.setText("");
                }
            }
        } catch (NumberFormatException e) {
            pinAttempts++;
            if (pinAttempts >= MAX_PIN_ATTEMPTS) {
                jlblPinStatus.setText("Card Blocked - Too Many Attempts");
                jlblPinStatus.setForeground(new java.awt.Color(255, 0, 0));
                jlblDisplay.setText("BLOCKED");
                disableAllButtons();
                JOptionPane.showMessageDialog(this,
                        "Your card has been blocked due to too many incorrect PIN attempts.\nPlease contact your bank.",
                        "Card Blocked", JOptionPane.ERROR_MESSAGE);
            } else {
                int remainingAttempts = MAX_PIN_ATTEMPTS - pinAttempts;
                jlblPinStatus.setText("Invalid Input - " + remainingAttempts + " attempts left");
                jlblPinStatus.setForeground(new java.awt.Color(255, 0, 0));
                jlblDisplay.setText("");
            }
        }
    }

    // Helper method to disable all buttons when card is blocked
    private void disableAllButtons() {
        jbtn1.setEnabled(false);
        jbtn2.setEnabled(false);
        jbtn3.setEnabled(false);
        jbtn4.setEnabled(false);
        jbtn5.setEnabled(false);
        jbtn6.setEnabled(false);
        jbtn7.setEnabled(false);
        jbtn8.setEnabled(false);
        jbtn9.setEnabled(false);
        jbtnZero.setEnabled(false);
        jButton14.setEnabled(false);
        jButton15.setEnabled(false);
        jbtnEnter.setEnabled(false);
        jbtnClear.setEnabled(false);
    }

    // Clear display and reset system
    private void jbtnClearActionPerformed(java.awt.event.ActionEvent evt) {
        jlblDisplay.setText("");
        jLoanCal.setEnabled(false);
        jReset.setEnabled(false);
        jExit.setEnabled(false);
        jReceipt.setEnabled(false);
        jbtnBalance.setEnabled(false);
        jbtnLoan.setEnabled(false);
        jbtnWithdraw.setEnabled(false);
        jbtnDeposit.setEnabled(false);
    }

    // ATM Functions
    private void jbtnBalanceActionPerformed(java.awt.event.ActionEvent evt) {
        jlblDisplay.setText("£" + String.format("%.2f", currentBalance));
    }

    private void jbtnWithdrawActionPerformed(java.awt.event.ActionEvent evt) {
        String input = JOptionPane.showInputDialog(this, "Enter amount to withdraw:");
        if (input != null && !input.trim().isEmpty()) {
            try {
                double amount = Double.parseDouble(input);
                if (amount > 0 && amount <= currentBalance) {
                    currentBalance -= amount;
                    jlblDisplay.setText("Withdrawn: £" + String.format("%.2f", amount));
                    JOptionPane.showMessageDialog(this,
                            "Transaction successful!\nNew balance: £" + String.format("%.2f", currentBalance));
                } else if (amount > currentBalance) {
                    JOptionPane.showMessageDialog(this, "Insufficient funds!");
                } else {
                    JOptionPane.showMessageDialog(this, "Invalid amount!");
                }
            } catch (NumberFormatException e) {
                JOptionPane.showMessageDialog(this, "Invalid input!");
            }
        }
    }

    private void jbtnDepositActionPerformed(java.awt.event.ActionEvent evt) {
        String input = JOptionPane.showInputDialog(this, "Enter amount to deposit:");
        if (input != null && !input.trim().isEmpty()) {
            try {
                double amount = Double.parseDouble(input);
                if (amount > 0) {
                    currentBalance += amount;
                    jlblDisplay.setText("Deposited: £" + String.format("%.2f", amount));
                    JOptionPane.showMessageDialog(this,
                            "Transaction successful!\nNew balance: £" + String.format("%.2f", currentBalance));
                } else {
                    JOptionPane.showMessageDialog(this, "Invalid amount!");
                }
            } catch (NumberFormatException e) {
                JOptionPane.showMessageDialog(this, "Invalid input!");
            }
        }
    }

    // Loan calculation functionality
    private void jbtnLoanActionPerformed(java.awt.event.ActionEvent evt) {
        jLoanCal.setEnabled(true);
        jReset.setEnabled(true);
        jExit.setEnabled(true);
        jReceipt.setEnabled(true);
        jlblDisplay.setText("Loan Mode");
    }

    private void jLoanCalActionPerformed(java.awt.event.ActionEvent evt) {
        try {
            // Input validation
            if (jtxtnumberofyears.getText().trim().isEmpty() ||
                    jtxtEnteloanamount.getText().trim().isEmpty()) {
                JOptionPane.showMessageDialog(this, "Please fill in Number of Years and Loan Amount!");
                return;
            }

            int numberOfYears = Integer.parseInt(jtxtnumberofyears.getText());
            double loanAmount = Double.parseDouble(jtxtEnteloanamount.getText());

            // Validation checks
            if (numberOfYears <= 0 || loanAmount <= 0) {
                JOptionPane.showMessageDialog(this, "Please enter valid positive values!");
                return;
            }

            // Get interest rate (automatically calculated)
            double annualInterestRate;
            String interestRateText = jtxtInterestRate.getText().replace("%", "");
            if (interestRateText.isEmpty()) {
                updateInterestRate(); // Update if not already done
                interestRateText = jtxtInterestRate.getText().replace("%", "");
            }
            annualInterestRate = Double.parseDouble(interestRateText);

            double monthlyInterestRate = annualInterestRate / 1200; // Convert to monthly decimal
            int totalMonths = numberOfYears * 12;

            // Calculate monthly payment using standard loan formula
            double monthlyPayment;
            if (monthlyInterestRate == 0) {
                // If no interest, simple division
                monthlyPayment = loanAmount / totalMonths;
            } else {
                monthlyPayment = loanAmount * monthlyInterestRate /
                        (1 - Math.pow(1 + monthlyInterestRate, -totalMonths));
            }

            double totalPayment = monthlyPayment * totalMonths;

            // Display results
            jlblmonthlyPayment.setText(String.format("£%.2f", monthlyPayment));
            jlbltotalPayment.setText(String.format("£%.2f", totalPayment));

        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "Please enter valid numbers!");
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "Error in calculation: " + e.getMessage());
        }
    }

    private void jReceiptActionPerformed(java.awt.event.ActionEvent evt) {
        try {
            if (jlblmonthlyPayment.getText().isEmpty() || jlbltotalPayment.getText().isEmpty()) {
                JOptionPane.showMessageDialog(this, "Please calculate loan first!");
                return;
            }

            String numberOfYears = jtxtnumberofyears.getText();
            String loanAmount = jtxtEnteloanamount.getText();
            String annualInterestRate = jtxtInterestRate.getText();
            String monthlyPayment = jlblmonthlyPayment.getText();
            String totalPayment = jlbltotalPayment.getText();

            // Generate reference number
            int refs = 1325 + (int) (Math.random() * 4238);

            // Get current date and time
            Calendar timer = Calendar.getInstance();
            SimpleDateFormat timeFormat = new SimpleDateFormat("HH:mm:ss");
            SimpleDateFormat dateFormat = new SimpleDateFormat("dd-MMM-yyyy");

            // Generate receipt
            jtxtReceipt.setText("");
            jtxtReceipt.append("\t\tLoan Management System\n");
            jtxtReceipt.append("Reference:\t\t\t" + refs + "\n");
            jtxtReceipt.append("=======================================\n");
            jtxtReceipt.append("Repayment years:\t\t" + numberOfYears + "\n");
            jtxtReceipt.append("Amount of Loan:\t\t\t£" + loanAmount + "\n");
            jtxtReceipt.append("Interest rate:\t\t\t" + annualInterestRate + "\n");
            jtxtReceipt.append("Monthly payment:\t\t" + monthlyPayment + "\n");
            jtxtReceipt.append("Total payment:\t\t\t" + totalPayment + "\n");
            jtxtReceipt.append("=======================================\n");
            jtxtReceipt.append("Date: " + dateFormat.format(timer.getTime()));
            jtxtReceipt.append("\t\tTime: " + timeFormat.format(timer.getTime()) + "\n\n");
            jtxtReceipt.append("\t\tThank you\n");

        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "Error generating receipt: " + e.getMessage());
        }
    }

    private void jResetActionPerformed(java.awt.event.ActionEvent evt) {
        jtxtnumberofyears.setText("");
        jtxtEnteloanamount.setText("");
        jtxtInterestRate.setText("");
        jlblmonthlyPayment.setText("");
        jlbltotalPayment.setText("");
        jtxtReceipt.setText("");
        jlblDisplay.setText("Reset Complete");
    }

    private void jbtnCancelActionPerformed(java.awt.event.ActionEvent evt) {
        frame = new JFrame("Exit");
        if (JOptionPane.showConfirmDialog(frame, "Confirm if you want to exit",
                "ATM System", JOptionPane.YES_NO_OPTION) == JOptionPane.YES_OPTION) {
            System.exit(0);
        }
    }

    private void jExitActionPerformed(java.awt.event.ActionEvent evt) {
        frame = new JFrame("Exit");
        if (JOptionPane.showConfirmDialog(frame, "Confirm if you want to exit",
                "Loan Management System", JOptionPane.YES_NO_OPTION) == JOptionPane.YES_OPTION) {
            System.exit(0);
        }
    }

    // Input validation for numeric fields
    private void jtxtnumberofyearsKeyTyped(java.awt.event.KeyEvent evt) {
        char character = evt.getKeyChar();
        if (!(Character.isDigit(character) ||
                character == KeyEvent.VK_BACK_SPACE || character == KeyEvent.VK_DELETE)) {
            evt.consume();
        }
    }

    private void jtxtEnteloanamountKeyTyped(java.awt.event.KeyEvent evt) {
        char character = evt.getKeyChar();
        if (!(Character.isDigit(character) || character == '.' ||
                character == KeyEvent.VK_BACK_SPACE || character == KeyEvent.VK_DELETE)) {
            evt.consume();
        }
    }

    private void formWindowActivated(java.awt.event.WindowEvent evt) {
        // Disable all functions initially until PIN is entered
        jLoanCal.setEnabled(false);
        jReset.setEnabled(false);
        jExit.setEnabled(false);
        jReceipt.setEnabled(false);
        jbtnBalance.setEnabled(false);
        jbtnLoan.setEnabled(false);
        jbtnWithdraw.setEnabled(false);
        jbtnDeposit.setEnabled(false);

        // Set up initial display
        jPanel2.setVisible(true);
        jlblBalance.setVisible(false);
        jlblLoan.setVisible(false);
        jlblWithdraw.setVisible(false);
        jlblDeposit.setVisible(false);

        jlblDisplay.setText("");
        jlblPinStatus.setText("Enter PIN");
        jlblPinStatus.setForeground(new java.awt.Color(0, 0, 0)); // Black color initially
        pinAttempts = 0; // Reset attempts when window activates
    }

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ReflectiveOperationException | javax.swing.UnsupportedLookAndFeelException ex) {
            logger.log(java.util.logging.Level.SEVERE, null, ex);
        }

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(() -> new ATMS().setVisible(true));
    }

    // Variables declaration - do not modify
    private javax.swing.JButton jButton14;
    private javax.swing.JButton jButton15;
    private javax.swing.JButton jButton16;
    private javax.swing.JButton jExit;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JButton jLoanCal;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JPanel jPanel6;
    private javax.swing.JButton jReceipt;
    private javax.swing.JButton jReset;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JTextArea jtxtReceipt;
    private javax.swing.JTextArea jTextArea2;
    private javax.swing.JTextField jtxtEnteloanamount;
    private javax.swing.JTextField jlblmonthlyPayment;
    private javax.swing.JTextField jlbltotalPayment;
    private javax.swing.JButton jbtn1;
    private javax.swing.JButton jbtn2;
    private javax.swing.JButton jbtn3;
    private javax.swing.JButton jbtn4;
    private javax.swing.JButton jbtn5;
    private javax.swing.JButton jbtn6;
    private javax.swing.JButton jbtn7;
    private javax.swing.JButton jbtn8;
    private javax.swing.JButton jbtn9;
    private javax.swing.JButton jbtnBalance;
    private javax.swing.JButton jbtnCancel;
    private javax.swing.JButton jbtnClear;
    private javax.swing.JButton jbtnDeposit;
    private javax.swing.JButton jbtnEnter;
    private javax.swing.JButton jbtnLoan;
    private javax.swing.JButton jbtnWithdraw;
    private javax.swing.JButton jbtnZero;
    private javax.swing.JLabel jlblDisplay;
    private javax.swing.JLabel jlblPinStatus;
    private javax.swing.JLabel jlblBalance;
    private javax.swing.JLabel jlblLoan;
    private javax.swing.JLabel jlblWithdraw;
    private javax.swing.JLabel jlblDeposit;
    private javax.swing.JTextField jtxtnumberofyears;
    private javax.swing.JTextField jtxtInterestRate;
    // End of variables declaration
}